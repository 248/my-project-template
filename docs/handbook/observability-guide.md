---
title: Observability Guide
author: @claude
created: 2025-09-03
updated: 2025-09-03
status: published
---

# Observability Guide

## 設計思想

プロジェクトテンプレートでは以下の観測可能性（Observability）アーキテクチャを採用しています：

- **統一トレーシング**: OpenTelemetryによる分散トレーシング基盤
- **構造化ログ**: Pinoベースの JSON 構造化ログシステム
- **相関追跡**: トレースIDとログの自動相関による問題の迅速な特定

## アーキテクチャ概要

### OpenTelemetry統合設計

- **自動インストルメンテーション**: HTTPリクエスト、データベースアクセス、外部API呼び出しの自動計測
- **OTLP エクスポート**: 標準プロトコルによるメトリクス・トレースデータの外部送信
- **リソース属性**: サービス名、バージョン、環境情報の自動付与

### ログシステム設計

- **構造化データ**: JSON形式による機械可読ログ出力
- **トレース相関**: ログメッセージへのtraceIdとspanIdの自動埋め込み
- **環境対応**: 開発環境では人間可読、本番環境では構造化出力

## システム構成

### 核となるモジュール

- **telemetry.ts**: OpenTelemetry SDK の中央集約初期化
- **tracing.ts**: HTTPリクエストレベルでのスパン自動生成ミドルウェア
- **logger.ts**: 名前付きロガーファクトリーとトレース統合

## 環境設定方針

### OpenTelemetry設定

- **OTEL_EXPORTER_OTLP_ENDPOINT**: メトリクス・トレース送信先エンドポイント
- **SERVICE_NAME/SERVICE_VERSION**: サービス識別とバージョン管理
- **OTEL_DEBUG**: 開発時デバッグ出力制御

### ログレベル制御

- **LOG_LEVEL**: 実行時ログレベル動的調整（info, debug, warn, error）

## 運用指針

### 初期化順序の重要性

OpenTelemetryは全モジュールより先に初期化することで自動インストルメンテーションの確実な動作を保証する

### 本番環境考慮事項

- デバッグモードは開発環境のみで有効化
- トレースデータの適切なエクスポート先設定
- ログ出力量とパフォーマンスのバランス調整

## 将来拡張計画

### マルチランゲージ対応

Go言語においてもslog/zerologを使用した同等の観測可能性システムを構築予定

### 監視システム統合

外部監視プラットフォーム（Grafana、Jaeger等）との統合により運用監視体制を強化
