---
title: Vitestãƒ†ã‚¹ãƒˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰
author: @claude
created: 2025-09-05
updated: 2025-09-05
status: published
---

# Vitestãƒ†ã‚¹ãƒˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰

> å®Ÿè£…æ¸ˆã¿Vitestãƒ†ã‚¹ãƒˆç’°å¢ƒã®ä½¿ç”¨æ–¹æ³•ã¨å®Ÿè·µãƒ‘ã‚¿ãƒ¼ãƒ³

## ğŸš€ æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯Vitestã‚’ä½¿ç”¨ã—ãŸåŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã„ã¾ã™ã€‚React Testing Libraryã¨ã®çµ±åˆã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ãƒ„ãƒ¼ãƒ«ã®å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§å“è³ªä¿è¨¼ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

---

## ğŸ› ï¸ ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹æˆ

### åŸºæœ¬æ§‹æˆ

```
project-root/
â”œâ”€â”€ vitest.config.js          # ViteståŸºæœ¬è¨­å®š
â”œâ”€â”€ vitest.setup.js           # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”œâ”€â”€ packages/ui/src/components/__tests__/     # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ apps/frontend/src/components/__tests__/   # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ apps/backend/src/**/__tests__/            # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
â””â”€â”€ tools/message-codegen/__tests__/          # ãƒ„ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
```

### ä¸»è¦è¨­å®š

#### vitest.config.js

- **ç’°å¢ƒ**: jsdomï¼ˆReact DOM ãƒ†ã‚¹ãƒˆç”¨ï¼‰
- **ã‚°ãƒ­ãƒ¼ãƒãƒ«**: describe, it, expect ã‚’å…¨åŸŸã§åˆ©ç”¨å¯èƒ½
- **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**: vitest.setup.js ã§å…±é€šåˆæœŸåŒ–
- **ã‚«ãƒãƒ¬ãƒƒã‚¸**: v8 providerã€HTML/JSON/ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼
- **ã‚¨ã‚¤ãƒªã‚¢ã‚¹**: `@` â†’ apps/frontend/srcã€API contractsè§£æ±º

#### vitest.setup.js

- **DOMæ‹¡å¼µ**: @testing-library/jest-dom ãƒãƒƒãƒãƒ£ãƒ¼
- **è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ãƒ†ã‚¹ãƒˆé–“ã§ã®ãƒ¢ãƒƒã‚¯ãƒ»DOMçŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†é¡

### 1. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ

**å¯¾è±¡**: `packages/ui/src/components/__tests__/Button.test.tsx`ï¼ˆ23ãƒ†ã‚¹ãƒˆï¼‰

**ä¸»è¦ãƒ†ã‚¹ãƒˆãƒã‚¤ãƒ³ãƒˆ**:

- âœ… åŸºæœ¬ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ»Propsæ¤œè¨¼
- âœ… ãƒãƒªã‚¢ãƒ³ãƒˆãƒ»ã‚µã‚¤ã‚ºãƒ»çŠ¶æ…‹åˆ¥ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨
- âœ… ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆonClickã€disabledï¼‰
- âœ… ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼ˆroleã€focusã€keyboardï¼‰
- âœ… çµ„ã¿åˆã‚ã›Propsãƒ»å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ

### 2. éåŒæœŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ

**å¯¾è±¡**: `apps/frontend/src/components/__tests__/HealthCheckButton.test.tsx`ï¼ˆ13ãƒ†ã‚¹ãƒˆï¼‰

**ä¸»è¦ãƒ†ã‚¹ãƒˆãƒã‚¤ãƒ³ãƒˆ**:

- âœ… API ãƒ¢ãƒƒã‚­ãƒ³ã‚° (`vi.mock()`)
- âœ… éåŒæœŸå‡¦ç†å¾…æ©Ÿ (`waitFor`)
- âœ… ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- âœ… Promiseæ‰‹å‹•åˆ¶å¾¡ãƒ»çŠ¶æ…‹é·ç§»
- âœ… è¤‡æ•°å®Ÿè¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»ã‚¨ãƒ©ãƒ¼å›å¾©

### 3. ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ãƒ†ã‚¹ãƒˆ

**å¯¾è±¡**: `apps/backend/src/lib/__tests__/api-response.test.ts`ï¼ˆ31ãƒ†ã‚¹ãƒˆï¼‰

**ä¸»è¦ãƒ†ã‚¹ãƒˆãƒã‚¤ãƒ³ãƒˆ**:

- âœ… ç´”ç²‹é–¢æ•°ã®å…¥å‡ºåŠ›æ¤œè¨¼
- âœ… è¤‡é›‘ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ»ãƒã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‡¦ç†
- âœ… ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹å‹•ä½œåˆ†å² (`vi.stubEnv`)
- âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»å¢ƒç•Œå€¤ãƒ»ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹
- âœ… å‹å®‰å…¨æ€§ãƒ»discriminated union

### 4. ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ

**å¯¾è±¡**: `tools/message-codegen/__tests__/add-message-utils.test.js`ï¼ˆ43ãƒ†ã‚¹ãƒˆï¼‰

**ä¸»è¦ãƒ†ã‚¹ãƒˆãƒã‚¤ãƒ³ãƒˆ**:

- âœ… å¼•æ•°è§£æãƒ»ã‚³ãƒãƒ³ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³
- âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ­£å¸¸ãƒ»ç•°å¸¸ï¼‰
- âœ… é…åˆ—ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œ
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«I/Oãƒ»YAMLå‡¦ç†
- âœ… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ»ä¾‹å¤–å‡¦ç†

---

## ğŸ“‹ ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰

### åŸºæœ¬å®Ÿè¡Œ

```bash
pnpm test              # å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test:watch        # ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰
pnpm test:ui           # UIä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test:coverage     # ã‚«ãƒãƒ¬ãƒƒã‚¸å–å¾—
```

### ã‚«ãƒ†ã‚´ãƒªåˆ¥å®Ÿè¡Œ

```bash
pnpm test:components   # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã¿
pnpm test:backend      # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã¿
pnpm test:tools        # ãƒ„ãƒ¼ãƒ«ã®ã¿
```

### ãƒ‡ãƒãƒƒã‚°ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```bash
pnpm test --reporter=verbose                    # è©³ç´°å‡ºåŠ›
pnpm test --bail=1                              # åˆå›å¤±æ•—ã§åœæ­¢
pnpm test Button.test.tsx --watch               # ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¦ã‚©ãƒƒãƒ
pnpm test --grep "should render"                # ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒ
```

---

## ğŸ¯ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```typescript
describe('ComponentName', () => {
  describe('Basic Rendering', () => {
    // åŸºæœ¬ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ»Props
  })

  describe('User Interactions', () => {
    // ã‚¤ãƒ™ãƒ³ãƒˆãƒ»çŠ¶æ…‹å¤‰æ›´
  })

  describe('Error Handling', () => {
    // ã‚¨ãƒ©ãƒ¼ãƒ»å¢ƒç•Œå€¤
  })
})
```

### å‘½åè¦å‰‡

- âœ… **Good**: `should render error message when API call fails`
- âŒ **Bad**: `should work`, `handles errors`

### ãƒ¢ãƒƒã‚¯æˆ¦ç•¥

- **API**: `vi.mock('@/lib/api')` ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å…¨ä½“
- **é–¢æ•°**: `vi.fn()` ã§å€‹åˆ¥é–¢æ•°
- **ç’°å¢ƒå¤‰æ•°**: `vi.stubEnv()` ã§ç’°å¢ƒåˆ†å²
- **Promise**: æ‰‹å‹•åˆ¶å¾¡ã§ã‚¿ã‚¤ãƒŸãƒ³ã‚°èª¿æ•´

### éåŒæœŸãƒ‘ã‚¿ãƒ¼ãƒ³

- **waitFor**: çŠ¶æ…‹å¤‰åŒ–å¾…æ©Ÿ
- **Promiseåˆ¶å¾¡**: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãƒ†ã‚¹ãƒˆ
- **setTimeout**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ»é…å»¶å‡¦ç†
- **cleanup**: ãƒ†ã‚¹ãƒˆé–“çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ

---

## âš ï¸ ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«

### Timeoutã‚¨ãƒ©ãƒ¼

```typescript
// ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå»¶é•·
it('should handle slow API', async () => {
  /* */
}, 10000)
await waitFor(
  () => {
    /* */
  },
  { timeout: 10000 }
)
```

### DOM ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼

```typescript
// setup ãƒ•ã‚¡ã‚¤ãƒ«ã§è‡ªå‹•è¨­å®šæ¸ˆã¿
afterEach(() => {
  cleanup()
  vi.clearAllMocks()
})
```

### Moduleè§£æ±ºã‚¨ãƒ©ãƒ¼

```typescript
// vitest.config.js ã®aliasç¢ºèª
// ã¾ãŸã¯ç›¸å¯¾ãƒ‘ã‚¹ä½¿ç”¨: vi.mock('../lib/api')
```

### React importã‚¨ãƒ©ãƒ¼

```typescript
// æ˜ç¤ºçš„importè¿½åŠ 
import React from 'react'
```

---

## ğŸ“š é–¢é€£ãƒªã‚½ãƒ¼ã‚¹

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[Vitest](https://vitest.dev/)** - ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **[React Testing Library](https://testing-library.com/docs/react-testing-library/intro/)** - Reactãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- **[@testing-library/jest-dom](https://github.com/testing-library/jest-dom)** - DOMãƒãƒƒãƒãƒ£ãƒ¼æ‹¡å¼µ

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…å®Ÿè£…ä¾‹

- `packages/ui/src/components/__tests__/Button.test.tsx` - åŸºæœ¬ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
- `apps/frontend/src/components/__tests__/HealthCheckButton.test.tsx` - éåŒæœŸãƒ»è¤‡é›‘ãƒ†ã‚¹ãƒˆ
- `apps/backend/src/lib/__tests__/api-response.test.ts` - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ãƒ†ã‚¹ãƒˆ
- `tools/message-codegen/__tests__/add-message-utils.test.js` - CLIãƒ„ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[ãƒ†ã‚¹ãƒˆæˆ¦ç•¥](./testing-strategy.md)** - å…¨ä½“æˆ¦ç•¥ãƒ»å“è³ªæ–¹é‡
- **[é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰](./developer-guide.md)** - é–‹ç™ºç’°å¢ƒãƒ»ã‚³ãƒãƒ³ãƒ‰
- **[ã‚³ãƒ¼ãƒ‰è¦ç´„](../styleguide/code-standards.md)** - ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ¨™æº–

---

**ğŸ’¡ ã“ã®ã‚¬ã‚¤ãƒ‰ã¯å®Ÿè£…æ¸ˆã¿ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’æœ€å¤§é™æ´»ç”¨ã™ã‚‹ãŸã‚ã®å®Ÿè·µãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§ã™ã€‚æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹éš›ã®å‚è€ƒã¨ã—ã¦æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚**
